<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>独属于王岚的小域</title>
    <script src="https://cdn.jsdelivr.net/npm/crypto-js@4.2.0/crypto-js.min.js"></script>
    <style>
        /* 保持原有样式不变 */
        #content { display: none; }
        #error { color: #dc3545; text-align: center; margin: 1rem 0; display: none; }
    </style>
</head>
<body>
    <div id="error">密码错误，请重试！</div>
    <div id="content">
        <!-- 原有HTML内容 -->
    </div>

    <script>
        // 重新计算的哈希值（请确保与控制台输出一致）
        const correctHash = "e813c60f292993f58593637b74c4f1f07a35326e0762732936360d29d431b6d";

        function checkLoginStatus() {
            const isVerified = localStorage.getItem("isVerified");
            const expireTime = localStorage.getItem("expireTime");
            if (isVerified === "true" && new Date().getTime() < expireTime) {
                document.getElementById("content").style.display = "block";
                return true;
            }
            return false;
        }

        function verifyPassword() {
            const userInput = prompt("请输入密码访问小屋：");
            if (!userInput) {
                document.getElementById("error").style.display = "block";
                return;
            }
            
            const inputHash = CryptoJS.SHA256(userInput).toString();
            
            if (inputHash === correctHash) {
                const expireTime = new Date().getTime() + 3600000;
                localStorage.setItem("isVerified", "true");
                localStorage.setItem("expireTime", expireTime);
                document.getElementById("content").style.display = "block";
                document.getElementById("error").style.display = "none";
            } else {
                document.getElementById("error").style.display = "block";
                if (localStorage.getItem("retryCount") < 3) {
                    localStorage.setItem("retryCount", parseInt(localStorage.getItem("retryCount") || 0) + 1);
                    verifyPassword();
                } else {
                    alert("尝试次数过多，即将关闭页面");
                    window.close();
                }
            }
        }

        if (!checkLoginStatus()) {
            verifyPassword();
        }
    </script>
</body>
</html>
